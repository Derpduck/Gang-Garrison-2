<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="CREATE" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">{
    global.levelchoice = 1
    menu_create(40, 300, 200, 200, 30);
    menu_addlink("Host Game", 'event_user(0);');
    menu_addlink("Join (lobby)", '
        room_goto_fix(Lobby);
    ');
    menu_addlink("Join (manual)", '
        global.isHost = false;
        global.serverIP = get_string("Please enter the IP address or hostname of the server you want to join", "127.0.0.1");
        global.serverPort = get_integer("Please enter the port of the server you want to join", 8190);
        instance_create(0,0,Client);
        Client.returnRoom = Menu;
    ');
    menu_addlink("Options", '
        room_goto_fix(Options);
    ');
    menu_addlink("Stats", '
        room_goto_fix(StatsR);
    ');
    menu_addlink("Watch Replay", '
        global.isHost = false;
        global.isPlayingReplay = 1;
    
        loadReplay();
        if !global.isPlayingReplay// If the user gave an invalid file.
        {
            exit
        }
    
        global.serverIP = 127.0.0.1
        global.serverPort = global.hostingPort
        instance_create(0,0,Client);
        Client.returnRoom = Menu;
    ');
    menu_addlink("Credits", '
        room_goto_fix(Credits);
    ');
    //menu_addlink("Visit The Forums",'
        //action_splash_web("http://www.ganggarrison.com/forums/index.php", 1)
    //');
    menu_addback("Quit", '
        game_end();
    ');

    // Music setting set to "Menu Only" or "Menu and In-Game"
    if (!sound_isplaying(global.MenuMusic)
        &amp;&amp; (global.music == MUSIC_MENU_ONLY || global.music == MUSIC_BOTH))
    {
        AudioControlPlaySong(global.MenuMusic);
    }

    fade = 0;
    
    if global.dsmBackground==0{
    // ini says we have a downloaded background
    if (global.backgroundHash != "default")
    {
        var validBackground;
        validBackground = false;

        // already loaded background in a previous instance
        if (variable_global_exists("downloadedBackground"))
        {
            menuimage = global.downloadedBackground;
            validBackground = true;
        }
        // haven't loaded yet, background exists
        else if (file_exists("background.png"))
        {
            // passes integrity check
            if (global.backgroundHash == GG2DLL_compute_MD5("background.png"))
            {
                // use downloaded background
                global.downloadedBackground = background_add("background.png", false, false);
                menuimage = global.downloadedBackground;
                validBackground = true;
            }
        }
        // otherwise, reset values
        if (!validBackground)
        {
            global.backgroundHash = "default";
            global.backgroundTitle = "";
            global.backgroundURL = "";
            global.backgroundShowVersion = true;
            ini_open("gg2.ini");
            ini_write_string("Background", "BackgroundHash", global.backgroundHash);
            ini_write_string("Background", "BackgroundTitle", global.backgroundTitle);
            ini_write_string("Background", "BackgroundURL", global.backgroundURL);
            ini_write_real("Background", "BackgroundShowVersion", global.backgroundShowVersion);
            ini_close();
        }
    }
    
    }

    // use default background if ini says we should
    if (global.backgroundHash == "default") or global.dsmBackground==3
    {
        menuimage = choose(MenuBackground1, MenuBackground2);
    }
    
    if global.dsmBackground==1{ //Match text colour
        if global.textHighlightColour==0{
            menuimage=DSM_MenuBackground2
        }else if global.textHighlightColour==1{
            menuimage=DSM_MenuBackground3
        }else if global.textHighlightColour==2{
            menuimage=DSM_MenuBackground1
        }else if global.textHighlightColour==3{ //Random
            menuimage=choose(DSM_MenuBackground1,DSM_MenuBackground2,DSM_MenuBackground3)
            versionImage=choose(DSM_MenuBackgroundVersion1S,DSM_MenuBackgroundVersion2S,DSM_MenuBackgroundVersion3S)
        }
    }else if global.dsmBackground==2{ //Any
        menuimage=choose(DSM_MenuBackground1,DSM_MenuBackground2,DSM_MenuBackground3)
        if menuimage==DSM_MenuBackground1{
            versionImage=DSM_MenuBackgroundVersion1S
        }else if menuimage==DSM_MenuBackground2{
            versionImage=DSM_MenuBackgroundVersion2S
        }else if menuimage==DSM_MenuBackground3{
            versionImage=DSM_MenuBackgroundVersion3S
        }
    }

    if(global.dedicatedMode == 1)
        event_user(0);
        
    colour1=make_color_rgb(random_range(0,255),random_range(0,255),random_range(0,255))
    colour2=make_color_rgb(random_range(0,255),random_range(0,255),random_range(0,255))
}
</argument>
      </arguments>
    </action>
  </actions>
</event>
