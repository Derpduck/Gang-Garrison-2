<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<event category="DRAW" id="0">
  <actions>
    <action id="603" library="1">
      <!--action name: Code-->
      <kind>CODE</kind>
      <allowRelative>false</allowRelative>
      <question>false</question>
      <canApplyTo>true</canApplyTo>
      <actionType>CODE</actionType>
      <functionName/>
      <relative>false</relative>
      <not>false</not>
      <appliesTo>.self</appliesTo>
      <arguments>
        <argument kind="STRING">if colour1==0 and colour2==0{
    colour1=make_color_rgb(random_range(0,255),random_range(0,255),random_range(0,255))
    colour2=make_color_rgb(random_range(0,255),random_range(0,255),random_range(0,255))
}

if(!variable_local_exists("baseybegin")) // This needs to be duplicated because of code execution order issues
{
    baseybegin = ybegin;
    mouse_samples = ds_list_create();
}
if(view_hview[0] &lt; 600)
{
    ds_list_add(mouse_samples, window_mouse_get_y());
    while(ds_list_size(mouse_samples) &gt; 10)
        ds_list_delete(mouse_samples, 0);
    var des_y;
    des_y = 0;
    for(i = 0; i &lt; ds_list_size(mouse_samples); i += 1)
        des_y += ds_list_find_value(mouse_samples, i);
    des_y /= ds_list_size(mouse_samples);
    
    ybegin = round(baseybegin
                   - min(1, max(0, des_y/view_hview[0]))
                     *(600-view_hview[0]));
}
{
    var i, val, gotVar, itemx, itemy, itemcount;
    menu_hack_backbutton();
    itemcount = menu_get_itemcount();
    
    if (dimmed)
    {   
        draw_set_color(c_black);
        draw_set_alpha(0.71);
        draw_rectangle(view_xview[0], view_yview[0], view_xview[0]+view_wview[0], view_yview[0]+view_hview[0], false);   
    }
    if (!dimmed and menumode and drawbg)
    {
        draw_set_color(c_black);
        draw_set_alpha(0.5);
        
        draw_pinched_blackrect(view_xview[0] + xbegin - bgoffsetx - 8,
                               view_yview[0] + ybegin - bgoffsety - 8,
                               bgwidth + 16, (itemcount-1)*spacing + bgheight + 16,
                               bginset, 4);
        
        draw_set_alpha(1);
    }
    
    // Dead block of state setters?
    draw_set_color(c_white);

    draw_set_valign(fa_middle);
    draw_set_halign(fa_left);
    draw_set_alpha(1);
    
    itemy = view_yview[0]+ybegin-taboffset;
    for(i=0; i&lt;tabs; i+=1)
    {
        itemx = view_xview[0]+xbegin+i*tabspacing+tabmargin;
        
        if(bgtabs)
        {
            draw_set_color(c_black);
            draw_set_alpha(0.5);
            
            draw_pinched_blackrect(itemx-bgoffsetx, itemy-bgoffsety, tabspacing-8, bgheight, bginset, bgbezel);
            
            draw_set_alpha(1);
        }
        
        if(i == -2-virtualitem and !editing){
            if global.dsmTextColour==0{
                draw_set_color(c_red)
            }else if global.dsmTextColour==1{
                draw_set_color(c_blue)
            }else if global.dsmTextColour==2{
                draw_set_color(c_green)
            }else if global.dsmTextColour==3{
                draw_set_color(c_yellow)
            }else if global.dsmTextColour==4{
                draw_set_color(c_purple)
            }else if global.dsmTextColour==5{
                draw_set_color(colour1)
            }
        }else{
            draw_set_color(c_white);
        }
        
        draw_text(itemx, itemy, tab_name[i]);
    }
    
    itemx = view_xview[0]+xbegin;
    for (i = 0; i &lt; itemcount; i += 1)
    {
        itemy = view_yview[0]+ybegin+i*spacing;
        if(drawbg)
        {
            draw_set_color(c_black);
            draw_set_alpha(0.5);
            
            draw_pinched_blackrect(itemx - bgoffsetx, itemy - bgoffsety, bgwidth, bgheight, bginset, bgbezel);
            
            draw_set_alpha(1);
        }
    
        if (editing == i){
            if global.dsmTextColour==0{
                draw_set_color(c_orange)
            }else if global.dsmTextColour==1{
                draw_set_color(c_aqua)
            }else if global.dsmTextColour==2{
                draw_set_color(c_lime)
            }else if global.dsmTextColour==3{
                draw_set_color(c_olive)
            }else if global.dsmTextColour==4{
                draw_set_color(c_fuchsia)
            }else if global.dsmTextColour==5{
                draw_set_color(colour2)
            }
        }else if(i == virtualitem and getsHighlight){
            if global.dsmTextColour==0{
                draw_set_color(c_red)
            }else if global.dsmTextColour==1{
                draw_set_color(c_blue)
            }else if global.dsmTextColour==2{
                draw_set_color(c_green)
            }else if global.dsmTextColour==3{
                draw_set_color(c_yellow)
            }else if global.dsmTextColour==4{
                draw_set_color(c_purple)
            }else if global.dsmTextColour==5{
                draw_set_color(colour1)
            }
        }else{
            draw_set_color(c_white);
        }

        draw_text(view_xview[0]+xbegin,view_yview[0]+ybegin+i*spacing,item_name[i]);
        
        switch (item_type[i])
        {
        case "script":
            val = "";
            break;
        
        case "edittext2":
        case "edittext":
        case "editnum":
            if (instance_exists(OptionsController) or instance_exists(LobbyController)) and (editing==i){
                val = item_value[i] + " ("+string((MAX_PLAYERNAME_LENGTH)-string_length(item_value[i]))+")"
            }else{
                val = item_value[i]
            }
            break;
        
        case "editselect":
            val = item_option_label[i, item_value[i]];
            break;
        
        case "editkey":
            if (editing == i)
            {
                val = "Please press a key";
                break;
            }
        case "editkeyormouse":
            if (editing == i)
            {
                val = "Please press a key or mouse button";
                break;
            }
            switch (menu_get_var(i))
            {
            case vk_alt:
                val = "Alt";
                break;
            case vk_control:
                val = "Control";
                break;
            case vk_down:
                val = "Down";
                break;
            case vk_up:
                val = "Up";
                break;
            case vk_left:
                val = "Left";
                break;
            case vk_right:
                val = "Right";
                break;
            case vk_enter:
                val = "Enter";
                break;
            case vk_tab:
                val = "Tab";
                break;
            case vk_space:
                val = "Space Bar";
                break;
            case vk_shift:
                val = "Shift";
                break;
            case MOUSE_LEFT:
                val = "Left Mouse Button";
                break;
            case MOUSE_RIGHT:
                val = "Right Mouse Button";
                break;
            //DSM: Function keys, MMB
            case vk_f1:
                val = "F1"
                break;
            case vk_f2:
                val = "F2"
                break;
            case vk_f3:
                val = "F3"
                break;
            case vk_f4:
                val = "F4"
                break;
            case vk_f5:
                val = "F5"
                break;
            case vk_f6:
                val = "F6"
                break;
            case vk_f7:
                val = "F7"
                break;
            case vk_f8:
                val = "F8"
                break;
            case vk_f9:
                val = "F9"
                break;
            case vk_f10:
                val = "F10"
                break;
            case vk_f11:
                val = "F11"
                break;
            case vk_f12:
                val = "F12"
                break;
            case MOUSE_MIDDLE:
                val = "Middle Mouse Button";
                break;
            default:
                gotVar = menu_get_var(i);
                //Numpad number buttons
                if (gotVar &gt;= 96 &amp;&amp; gotVar &lt;=  105){
                    val = "NUMPAD " + chr(gotVar - 48);
                }
                //Numpad other buttons
                else if (gotVar &gt;= 106 &amp;&amp; gotVar &lt;=  111){
                    val = "NUMPAD " + chr(gotVar - 64);
                }
                //Function buttons
                else if (gotVar &gt;= 112 &amp;&amp; gotVar &lt;= 123) {
                    val = "F" + string(gotVar - 111);
                }
                //Comma, dot, minus
                else if (gotVar &gt;= 188 &amp;&amp; gotVar &lt;= 190) {
                    val = chr(gotVar - 144);
                }
                else val = chr(menu_get_var(i));
                break;
            }
            break;
        }
        draw_text(view_xview[0]+xbegin+valueoffset,view_yview[0]+ybegin+i*spacing,sanitiseNewlines(val));
    }
}
</argument>
      </arguments>
    </action>
  </actions>
</event>
